(()=>{"use strict";function t(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&n(e)}}function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}var o="https://nomoreparties.co/v1/wff-cohort-38",r="ab8205ad-fc58-4233-b269-d7db741696e0";function c(t,e,n,o,r){var c=t.cloneNode(!0),i=c.querySelector(".card__image"),u=c.querySelector(".card__title"),a=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button");return c.querySelector(".card__like-counter").textContent=e.likeCount,i.src=e.link,c.id=e.id,i.alt=e.name,u.textContent=e.name,e.hasLiked&&s.classList.toggle("card__like-button_is-active"),e.isMyCard||a.remove(),i.addEventListener("click",(function(){return n(e)})),s.addEventListener("click",(function(){return o(c)})),a.addEventListener("click",(function(){return r(c)})),c}function i(t){var e,n=t.querySelector(".card__like-button"),c=t.querySelector(".card__like-counter");n.classList.contains("card__like-button_is-active")?(e=t.id,fetch("".concat(o,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:r,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){c.textContent=t.likes.length})):function(t){return fetch("".concat(o,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:r,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(t.id).then((function(t){c.textContent=t.likes.length})),n.classList.toggle("card__like-button_is-active")}var u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",noErrorClass:"popup__error_invisible",errorClass:"popup__error_visible"},a=function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent=null,o.classList.remove(n.errorClass)}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)},s=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},l=function(t,e){var n=t.querySelector(e.submitButtonSelector),o=Array.from(t.querySelectorAll(e.inputSelector));o.forEach((function(n){a(t,n,e)})),s(o,n,e)},p=document.querySelector("#card-template").content.querySelector(".card"),d=document.querySelector(".places__list"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".profile__add-button"),m=_.querySelector(".popup__button"),y=_.querySelector(".popup__form"),v=y.querySelector(".popup__input_type_url"),h=y.querySelector(".popup__input_type_card-name"),S=document.querySelector(".popup_type_image"),k=S.querySelector(".popup__image"),C=S.querySelector(".popup__caption"),q=document.querySelector(".popup_type_confirm"),b=q.querySelector(".popup__button"),L=document.querySelector(".popup_type_edit"),E=document.querySelector(".profile__edit-button"),g=L.querySelector(".popup__button"),j=L.querySelector(".popup__form"),x=L.querySelector(".popup__input_type_name"),P=L.querySelector(".popup__input_type_description"),T=document.querySelector(".popup_type_avatar"),A=T.querySelector(".popup__button"),z=T.querySelector(".popup__form"),M=T.querySelector(".popup__input_type_url"),B=document.querySelector(".profile__title"),w=document.querySelector(".profile__info"),D=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),N=document.querySelectorAll(".popup__close");function J(t){b.addEventListener("click",(function(){!function(t){(function(t){var e;t&&(e=t.id,fetch("".concat(o,"/cards/").concat(e),{method:"DELETE",headers:{authorization:r,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(){return t.remove()}))})(t),n(q)}(t)})),e(q)}function H(){l(z,u),e(T)}function V(t){k.src=t.link,k.alt=t.name,C.textContent=t.name,e(S)}document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(o,"/users/me"),{headers:{authorization:r}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(t){B.textContent=t.name,D.textContent=t.about,O.style.backgroundImage="url('"+t.avatar+"')",w.id=t._id})),fetch("".concat(o,"/cards"),{headers:{authorization:r}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(t){console.log(t),t.forEach((function(t){var e={name:t.name,link:t.link,id:t._id,likeCount:t.likes.length,isMyCard:w.id==t.owner._id,hasLiked:t.likes.some((function(t){return w.id==t._id}))},n=c(p,e,V,i,J);d.append(n)}))})).catch((function(t){return console.log(t)})),O.addEventListener("click",H),z.addEventListener("submit",(function(){return A.textContent="Сохранение...",void(t=M.value,fetch("".concat(o,"/users/me/avatar"),{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){O.style.src="url(".concat(t.avatar,")"),n(T),z.reset(),A.textContent="Сохранить"}));var t})),E.addEventListener("click",(function(){return x.value=B.textContent,P.value=D.textContent,l(j,u),void e(L)})),document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target===t&&n(t)}))})),f.addEventListener("click",(function(){y.reset(),l(y,u),e(_)})),N.forEach((function(t){t.addEventListener("click",(function(){n(t.closest(".popup"))}))})),y.addEventListener("submit",(function(t){t.preventDefault(),function(){m.textContent="Сохранение...";var t=h.value,e=v.value;(function(t,e){return fetch("".concat(o,"/cards"),{method:"POST",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))})(t,e).then((function(o){var r={name:t,link:e,id:o._id,isMyCard:!0,likeCount:0,hasLiked:!1},u=c(p,r,V,i,J);d.prepend(u),n(_),y.reset(),m.textContent="Сохранить"}))}()})),j.addEventListener("submit",(function(t){var e,c;t.preventDefault(),g.textContent="Сохранение...",(e=x.value,c=P.value,fetch("".concat(o,"/users/me"),{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:c})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(){B.textContent=x.value,D.textContent=P.value,n(L),j.reset(),g.textContent="Сохранить"}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);s(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){a(t,r,e),s(n,o,e)}))}))}(e,t)}))}(u)}))})();